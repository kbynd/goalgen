// Azure Container Apps Environment Module
// Creates a Container Apps managed environment with Log Analytics workspace
// Generated by GoalGen for: {{ goal_id }}

@description('Name of the Container Apps Environment')
param envName string

@description('Location for the environment')
param location string = resourceGroup().location

@description('Log Analytics Workspace Name')
param logAnalyticsName string

@description('Resource tags')
param tags object = {}

// Log Analytics Workspace for Container Apps logs
resource logAnalytics 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {
  name: logAnalyticsName
  location: location
  tags: tags
  properties: {
    sku: {
      name: 'PerGB2018'
    }
    retentionInDays: 30
  }
}

// Container Apps Environment
resource environment 'Microsoft.App/managedEnvironments@2023-05-01' = {
  name: envName
  location: location
  tags: tags
  properties: {
    appLogsConfiguration: {
      destination: 'log-analytics'
      logAnalyticsConfiguration: {
        customerId: logAnalytics.properties.customerId
        sharedKey: logAnalytics.listKeys().primarySharedKey
      }
    }
    workloadProfiles: [
      {
        name: 'Consumption'
        workloadProfileType: 'Consumption'
      }
    ]
  }
}

@description('Container Apps Environment ID')
output environmentId string = environment.id

@description('Container Apps Environment Name')
output environmentName string = environment.name

@description('Default Domain')
output defaultDomain string = environment.properties.defaultDomain

@description('Log Analytics Workspace ID')
output logAnalyticsId string = logAnalytics.id

@description('Log Analytics Customer ID')
output logAnalyticsCustomerId string = logAnalytics.properties.customerId
