#!/bin/bash
# Prepare build context for Docker cloud builds (ACR, GitHub Actions, etc.)
# Generated by GoalGen for: {{ goal_id }}

set -e

echo "üî® Preparing build context for Docker cloud builds..."

# Clean existing build context
if [ -d "build_context" ]; then
    echo "  Cleaning existing build_context..."
    rm -rf build_context
fi

mkdir -p build_context

# Copy source directories
echo "  Copying frmk..."
cp -r frmk build_context/

echo "  Copying workflow..."
cp -r workflow build_context/

echo "  Copying config..."
cp -r config build_context/

echo "  Copying orchestrator..."
cp -r orchestrator build_context/

# Copy Dockerfile to build context root
if [ -f "orchestrator/Dockerfile" ]; then
    echo "  Copying Dockerfile..."
    cp orchestrator/Dockerfile build_context/
else
    echo "  ‚ö†Ô∏è  Warning: orchestrator/Dockerfile not found"
fi

echo ""
echo "‚úÖ Build context prepared successfully!"
echo ""
echo "You can now run:"
echo "  # Build locally:"
echo "  podman build -f build_context/Dockerfile build_context/"
echo ""
echo "  # Build on ACR:"
echo "  az acr build --registry <acr-name> --image {{ goal_id }}:tag --file build_context/Dockerfile build_context/"
